/* eslint-disable */
//prettier-ignore
module.exports = {
name: "@yarnpkg/plugin-catalogs",
factory: function (require) {
var plugin=(()=>{var q=Object.create;var T=Object.defineProperty;var z=Object.getOwnPropertyDescriptor;var J=Object.getOwnPropertyNames;var Q=Object.getPrototypeOf,X=Object.prototype.hasOwnProperty;var R=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,r)=>(typeof require<"u"?require:e)[r]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});var Z=(t,e)=>{for(var r in e)T(t,r,{get:e[r],enumerable:!0})},D=(t,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of J(e))!X.call(t,n)&&n!==r&&T(t,n,{get:()=>e[n],enumerable:!(o=z(e,n))||o.enumerable});return t};var E=(t,e,r)=>(r=t!=null?q(Q(t)):{},D(e||!t||!t.__esModule?T(r,"default",{value:t,enumerable:!0}):r,t)),ee=t=>D(T({},"__esModule",{value:!0}),t);var be={};Z(be,{default:()=>he});var m=R("@yarnpkg/core");var F=(t=0)=>e=>`\x1B[${e+t}m`,B=(t=0)=>e=>`\x1B[${38+t};5;${e}m`,S=(t=0)=>(e,r,o)=>`\x1B[${38+t};2;${e};${r};${o}m`,l={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],gray:[90,39],grey:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgGray:[100,49],bgGrey:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}},Ce=Object.keys(l.modifier),te=Object.keys(l.color),re=Object.keys(l.bgColor),Ae=[...te,...re];function oe(){let t=new Map;for(let[e,r]of Object.entries(l)){for(let[o,n]of Object.entries(r))l[o]={open:`\x1B[${n[0]}m`,close:`\x1B[${n[1]}m`},r[o]=l[o],t.set(n[0],n[1]);Object.defineProperty(l,e,{value:r,enumerable:!1})}return Object.defineProperty(l,"codes",{value:t,enumerable:!1}),l.color.close="\x1B[39m",l.bgColor.close="\x1B[49m",l.color.ansi=F(),l.color.ansi256=B(),l.color.ansi16m=S(),l.bgColor.ansi=F(10),l.bgColor.ansi256=B(10),l.bgColor.ansi16m=S(10),Object.defineProperties(l,{rgbToAnsi256:{value(e,r,o){return e===r&&r===o?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(r/255*5)+Math.round(o/255*5)},enumerable:!1},hexToRgb:{value(e){let r=/[a-f\d]{6}|[a-f\d]{3}/i.exec(e.toString(16));if(!r)return[0,0,0];let[o]=r;o.length===3&&(o=[...o].map(i=>i+i).join(""));let n=Number.parseInt(o,16);return[n>>16&255,n>>8&255,n&255]},enumerable:!1},hexToAnsi256:{value:e=>l.rgbToAnsi256(...l.hexToRgb(e)),enumerable:!1},ansi256ToAnsi:{value(e){if(e<8)return 30+e;if(e<16)return 90+(e-8);let r,o,n;if(e>=232)r=((e-232)*10+8)/255,o=r,n=r;else{e-=16;let a=e%36;r=Math.floor(e/36)/5,o=Math.floor(a/6)/5,n=a%6/5}let i=Math.max(r,o,n)*2;if(i===0)return 30;let s=30+(Math.round(n)<<2|Math.round(o)<<1|Math.round(r));return i===2&&(s+=60),s},enumerable:!1},rgbToAnsi:{value:(e,r,o)=>l.ansi256ToAnsi(l.rgbToAnsi256(e,r,o)),enumerable:!1},hexToAnsi:{value:e=>l.ansi256ToAnsi(l.hexToAnsi256(e)),enumerable:!1}}),l}var ne=oe(),f=ne;var N=E(R("process"),1),P=E(R("os"),1),v=E(R("tty"),1);function u(t,e=globalThis.Deno?globalThis.Deno.args:N.default.argv){let r=t.startsWith("-")?"":t.length===1?"-":"--",o=e.indexOf(r+t),n=e.indexOf("--");return o!==-1&&(n===-1||o<n)}var{env:c}=N.default,I;u("no-color")||u("no-colors")||u("color=false")||u("color=never")?I=0:(u("color")||u("colors")||u("color=true")||u("color=always"))&&(I=1);function se(){if("FORCE_COLOR"in c)return c.FORCE_COLOR==="true"?1:c.FORCE_COLOR==="false"?0:c.FORCE_COLOR.length===0?1:Math.min(Number.parseInt(c.FORCE_COLOR,10),3)}function ie(t){return t===0?!1:{level:t,hasBasic:!0,has256:t>=2,has16m:t>=3}}function ae(t,{streamIsTTY:e,sniffFlags:r=!0}={}){let o=se();o!==void 0&&(I=o);let n=r?I:o;if(n===0)return 0;if(r){if(u("color=16m")||u("color=full")||u("color=truecolor"))return 3;if(u("color=256"))return 2}if("TF_BUILD"in c&&"AGENT_NAME"in c)return 1;if(t&&!e&&n===void 0)return 0;let i=n||0;if(c.TERM==="dumb")return i;if(N.default.platform==="win32"){let s=P.default.release().split(".");return Number(s[0])>=10&&Number(s[2])>=10586?Number(s[2])>=14931?3:2:1}if("CI"in c)return["GITHUB_ACTIONS","GITEA_ACTIONS","CIRCLECI"].some(s=>s in c)?3:["TRAVIS","APPVEYOR","GITLAB_CI","BUILDKITE","DRONE"].some(s=>s in c)||c.CI_NAME==="codeship"?1:i;if("TEAMCITY_VERSION"in c)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(c.TEAMCITY_VERSION)?1:0;if(c.COLORTERM==="truecolor"||c.TERM==="xterm-kitty")return 3;if("TERM_PROGRAM"in c){let s=Number.parseInt((c.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(c.TERM_PROGRAM){case"iTerm.app":return s>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(c.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(c.TERM)||"COLORTERM"in c?1:i}function L(t,e={}){let r=ae(t,{streamIsTTY:t&&t.isTTY,...e});return ie(r)}var le={stdout:L({isTTY:v.default.isatty(1)}),stderr:L({isTTY:v.default.isatty(2)})},G=le;function $(t,e,r){let o=t.indexOf(e);if(o===-1)return t;let n=e.length,i=0,s="";do s+=t.slice(i,o)+e+r,i=o+n,o=t.indexOf(e,i);while(o!==-1);return s+=t.slice(i),s}function V(t,e,r,o){let n=0,i="";do{let s=t[o-1]==="\r";i+=t.slice(n,s?o-1:o)+e+(s?`\r
`:`
`)+r,n=o+1,o=t.indexOf(`
`,n)}while(o!==-1);return i+=t.slice(n),i}var{stdout:W,stderr:Y}=G,k=Symbol("GENERATOR"),b=Symbol("STYLER"),C=Symbol("IS_EMPTY"),U=["ansi","ansi","ansi256","ansi16m"],O=Object.create(null),ce=(t,e={})=>{if(e.level&&!(Number.isInteger(e.level)&&e.level>=0&&e.level<=3))throw new Error("The `level` option should be an integer from 0 to 3");let r=W?W.level:0;t.level=e.level===void 0?r:e.level};var ue=t=>{let e=(...r)=>r.join(" ");return ce(e,t),Object.setPrototypeOf(e,A.prototype),e};function A(t){return ue(t)}Object.setPrototypeOf(A.prototype,Function.prototype);for(let[t,e]of Object.entries(f))O[t]={get(){let r=x(this,w(e.open,e.close,this[b]),this[C]);return Object.defineProperty(this,t,{value:r}),r}};O.visible={get(){let t=x(this,this[b],!0);return Object.defineProperty(this,"visible",{value:t}),t}};var M=(t,e,r,...o)=>t==="rgb"?e==="ansi16m"?f[r].ansi16m(...o):e==="ansi256"?f[r].ansi256(f.rgbToAnsi256(...o)):f[r].ansi(f.rgbToAnsi(...o)):t==="hex"?M("rgb",e,r,...f.hexToRgb(...o)):f[r][t](...o),fe=["rgb","hex","ansi256"];for(let t of fe){O[t]={get(){let{level:r}=this;return function(...o){let n=w(M(t,U[r],"color",...o),f.color.close,this[b]);return x(this,n,this[C])}}};let e="bg"+t[0].toUpperCase()+t.slice(1);O[e]={get(){let{level:r}=this;return function(...o){let n=w(M(t,U[r],"bgColor",...o),f.bgColor.close,this[b]);return x(this,n,this[C])}}}}var ge=Object.defineProperties(()=>{},{...O,level:{enumerable:!0,get(){return this[k].level},set(t){this[k].level=t}}}),w=(t,e,r)=>{let o,n;return r===void 0?(o=t,n=e):(o=r.openAll+t,n=e+r.closeAll),{open:t,close:e,openAll:o,closeAll:n,parent:r}},x=(t,e,r)=>{let o=(...n)=>pe(o,n.length===1?""+n[0]:n.join(" "));return Object.setPrototypeOf(o,ge),o[k]=t,o[b]=e,o[C]=r,o},pe=(t,e)=>{if(t.level<=0||!e)return t[C]?"":e;let r=t[b];if(r===void 0)return e;let{openAll:o,closeAll:n}=r;if(e.includes("\x1B"))for(;r!==void 0;)e=$(e,r.close,r.open),r=r.parent;let i=e.indexOf(`
`);return i!==-1&&(e=V(e,n,o,i)),o+e+n};Object.defineProperties(A.prototype,O);var de=A(),_e=A({level:Y?Y.level:0});var H=de;var y="root",p="catalog:",g=class extends Error{constructor(r,o){super(r);this.code=o;this.name="CatalogConfigurationError"}static{this.FILE_NOT_FOUND="FILE_NOT_FOUND"}static{this.INVALID_FORMAT="INVALID_FORMAT"}static{this.INVALID_ALIAS="INVALID_ALIAS"}},_=class{constructor(){this.configCache=new Map}async readConfiguration(e){let o=e.cwd,n=this.configCache.get(o);if(n)return n;let i=e.configuration.get("catalogs"),s=i;if(s.list=Object.entries(i.list).reduce((a,[d,h])=>(typeof h=="string"?a[y]={...a[y]||{},[d]:h}:a[d]=h,a),{}),!this.isValidConfiguration(s))throw new g("Invalid catalogs configuration format. Expected structure: { options?: { default?: string[] | 'max' }, list: { [alias: string]: { [packageName: string]: string } } }",g.INVALID_FORMAT);return this.configCache.set(o,s),s}async getRange(e,r,o){let n=await this.readConfiguration(e),i=r.length===0?y:r,s=n.list[i];if(!s)throw new g(`Alias "${i}" not found in .yarnrc.yml catalogs.`,g.INVALID_ALIAS);let a=s[o];if(!a)throw new g(`Package "${o}" not found in alias "${i}"`,g.INVALID_ALIAS);return/^[^:]+:/.test(a)?a:`${e.configuration.get("defaultProtocol")}${a}`}async getDefaultAliasGroups(e){let r=await this.readConfiguration(e.project);if(r.options&&r.options.default){if(Array.isArray(r.options.default))return r.options.default;if(r.options.default==="max"){let o=Object.keys(r.list),n=[...e.manifest.dependencies,...e.manifest.devDependencies],i=Object.fromEntries(o.map(a=>[a,0]));for(let[a,d]of n)if(d.range.startsWith(p)){let h=d.range.substring(p.length);i[h]=(i[h]||0)+1}let s=Math.max(...Object.values(i));return Object.keys(i).filter(a=>i[a]===s)}}return[]}async findDependency(e,r){let o=await this.readConfiguration(e),n=Object.entries(o.list).filter(([i,s])=>typeof s=="string"?r.name===s:Object.keys(s).includes(r.name));return n.length===0?[]:n.map(([i,s])=>{let a=typeof s=="string"?s:s[r.name];return[i,a]})}clearCache(e){this.configCache.delete(e)}isValidConfiguration(e){if(!e||typeof e!="object"||!e.list||typeof e.list!="object")return!1;for(let[r,o]of Object.entries(e.list)){if(!o||typeof o!="object")return!1;for(let n of Object.values(o))if(typeof n!="string")return!1}if(e.options&&e.options.default){if(Array.isArray(e.options.default)){if(e.options.default.length===0)return!1;let r=Object.keys(e.list);for(let o of e.options.default)if(o!=="root"&&!r.includes(o))return!1}else if(typeof e.options.default!="string"||e.options.default!=="max")return!1}return!0}};var j=new _,me={configuration:{catalogs:{description:"Define dependency version ranges as reusable constants across your project.",type:m.SettingsType.ANY,default:{}}},hooks:{reduceDependency:async(t,e,...r)=>{if(!t.range.startsWith(p))return t;try{let o=t.range.slice(p.length),n=m.structUtils.stringifyIdent(t),i=await j.getRange(e,o,n),s=m.structUtils.makeDescriptor(m.structUtils.makeIdent(t.scope,t.name),i),a=await e.configuration.reduceHook(d=>d.reduceDependency,s,e,...r);return a!==s?a:s}catch(o){throw o instanceof g?new Error(`Failed to resolve ${m.structUtils.stringifyDescriptor(t)}: ${o.message}`):o}},afterWorkspaceDependencyAddition:async(t,e,r)=>{K(t,r)},afterWorkspaceDependencyReplacement:async(t,e,r,o)=>{K(t,o)}}};async function K(t,e){if(e.range.startsWith(p))return;let r=await j.findDependency(t.project,e);if(r.length===0)return;let o=await j.getDefaultAliasGroups(t);if(o.length>0){for(let s of o)if(r.some(([a])=>a===s)){e.range=`${p}${s}`;return}}let n=r.map(([s])=>s===y?"":s),i=n.filter(s=>s!=="").length>0?` (${n.join(", ")})`:"";console.warn(H.yellow(`\u27A4 ${e.name} is listed in the catalogs config${i}, but it seems you're adding it without the catalog protocol. Consider running 'yarn add ${e.name}@${p}${n[0]}' instead.`))}var he=me;return ee(be);})();
return plugin;
}
};
